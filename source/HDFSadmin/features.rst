Особенности ACL для HDFS
------------------------

.. |br| raw:: html

   <br />


Реализация POSIX ACL
^^^^^^^^^^^^^^^^^^^^

Списки **ACL** на **HDFS** реализуются с помощью модели **ACL POSIX**. Если вы когда-либо использовали **POSIX ACL** в 
**файловой системе Linux**, **ACL** на **HDFS** работает также.



Совместимость и применение
~~~~~~~~~~~~~~~~~~~~~~~~~~


**HDFS** может связывать дополнительный **ACL** с любым файлом или каталогом. Все операции **HDFS**, которые обеспечивают соблюдение разрешений, выраженных с помощью **Permission Bits**, также должны обеспечить любой **ACL**, который определен для файла или каталога. Любая существующая логика, которая обходит **Permission Bits**, также обходит и **ACL**. Включая супер-пользователя **HDFS** и установку *false* в конфигурации *dfs.permissions*.



Доступ через ориентированные на пользователя конечные точки
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


**HDFS** поддерживает операции по настройке и получению **ACL**, связанного с файлом или каталогом. Эти операции доступны через несколько ориентированных на пользователя конечных точек. Эти конечные точки включают **FsShell CLI**, программную манипуляцию через классы **FileSystem** и **FileContext**, **WebHDFS** и **NFS**. 



Обратная связь пользователя: индикатор CLI для ACL
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

К перечисленным разрешениям любого файла или каталога с соответствующим **ACL** добавляется символ "+" (результат команды *ls -l*).



Обратная совместимость
~~~~~~~~~~~~~~~~~~~~~~

Реализация **ACL** обратно совместима с существующим применением разрешенных битов. Изменения, применяемые посредством **Permission Bits** (то есть *chmod*), также отображаются как изменения в **ACL**. Аналогично, изменения, применяемые к записям **ACL** для базовых классов пользователей ("Владелец", "Группа" и "Другие"), также отображаются в виде изменений в **Permission Bits**. Другими словами, операции **Permission Bits** и **ACL** управляют совместно используемой моделью, и операции **Permission Bits** можно рассматривать как подмножество операций **ACL**.



Низкие накладные расходы
~~~~~~~~~~~~~~~~~~~~~~~~

Добавление **ACL** не приводит к негативному влиянию на потребление системных ресурсов при развертывании, чтобы отказаться от использования **ACL**. Он включает в себя процессор, память, диск и пропускную способность сети.

Использование **ACL** влияет на производительность **NameNode**. Поэтому рекомендуется использовать **Permission Bits**, если это возможно, прежде чем использовать **ACL**.



Ограничения ACL
~~~~~~~~~~~~~~~

Количество записей в одном **ACL** ограничено максимум до *32*. Попытки добавить записи **ACL** сверх максимума выполняются с ошибкой, обращенной к пользователю. Это делается по двум причинам: упростить управление и ограничить потребление ресурсов. 

Списки **ACL** с очень большим количеством записей, как правило, трудно понять и могут указывать на то, что требования лучше устраняются путем определения дополнительных групп или пользователей. **ACL** с очень большим количеством записей также требуют большей памяти и хранилища, и для каждой проверки разрешений требуется больше времени. 

Число *32* соответствует максимальному количеству записей **ACL**, принудительно используемых семейством файловых систем *ext*.



Символические ссылки
~~~~~~~~~~~~~~~~~~~~

У символических ссылок нет собственных списков **ACL**. **ACL** символической ссылки всегда рассматривается как разрешения по умолчанию (*777* в **Permission Bits**). Операции, которые изменяют **ACL** символической ссылки, вместо этого изменяют саму символическую ссылку.



Снапшоты
~~~~~~~~

При создании снапшота все списки **ACL** блокируются. Изменения в **ACL** в момент создания снапшота не фиксируются.



Инструментарий
~~~~~~~~~~~~~~

Инструмент, который распространяет **Permission Bits**, не распространяет **ACL**. **ACL** включается командой *cp -p* и *distcp "-p"*. 



Варианты использования ACL на HDFS
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**ACL** на **HDFS** поддерживает следующие варианты использования:



Доступ нескольким пользователям
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

В данном разделе описывается случай, когда нескольким пользователям требуется доступ для чтения к файлу. При этом ни один из пользователей не является владельцем файла. И пользователи не являются членами общей группы, поэтому невозможно использовать групповые разрешения.

В данном случае устанавливается **ACL** доступ, содержащий несколько именованных пользовательских записей:

:command:`ACLs on HDFS supports the following use cases:`



Доступ нескольким группам
~~~~~~~~~~~~~~~~~~~~~~~~~

В данном разделе описывается случай, когда нескольким группам требуется чтение и запись в файл. При этом нет группы, объединяющей всех необходимых пользователей, поэтому невозможно использовать групповые разрешения.

В данном случае устанавливается **ACL** доступ, содержащий несколько именованных групповых записей:

:command:`group:sales:rw-` |br| 
:command:`group:execs:rw-`



Hive Partitioned Tables 
~~~~~~~~~~~~~~~~~~~~~~~

В данном случае **Hive** содержит секционированную таблицу данных о продажах. Ключ раздела – *country*. **Hive** сохраняет секционированные таблицы с помощью отдельного подкаталога для каждого определенного значения ключа раздела, поэтому структура файловой системы в **HDFS** выглядит так:

:command:`user` |br| 
:command:``-- hive` |br|
    :command:``-- warehouse` |br|
        :command:``-- sales` |br|
            :command:`|-- country=CN` |br|
            :command:`|-- country=GB` |br|
            :command:``-- country=US`

Группа *salesadmin* – это группа для всех этих файлов. Члены группы имеют доступ на чтение и запись ко всем файлам. Отдельные группы, зависящие от конкретной страны, могут запускать запросы на использование, которые только считывают данные для конкретной страны, например, *sales_CN*, *sales_GB* и *sales_US*. У этих групп нет доступа на запись.

Этот вариант использования можно решить, установив **ACL** доступ в каждом подкаталоге, содержащем запись собственной группы и именованной группы:

:command:`country=CN` |br| 
:command:`group::rwx` |br| 
:command:`group:sales_CN:r-x` |br| 

:command:`country=GB` |br| 
:command:`group::rwx` |br| 
:command:`group:sales_GB:r-x` |br| 

:command:`country=US` |br| 
:command:`group::rwx` |br| 
:command:`group:sales_US:r-x`

.. important:: Функциональность записи ACL группы владельца (запись группы без имени) эквивалентна установленным Permission Bits

Хранение в **Hive** в настоящее время не учитывает разрешения **ACL** в **HDFS**. Скорее, он проверяет доступ с использованием традиционной модели разрешений **POSIX**.


































