Высокая доступность (HA) и добавление/удаление YARN ResourceManager
===================================================================

При изначальной установке сервиса YARN в кластере ADH компонент YARN ResourceManager является `единой точкой отказа (Single point of failure) <https://en.wikipedia.org/wiki/Network_address_translation>`_. Это ознчает, что для обслуживания хоста или в случае его отказа весь сервис YARN становится неработоспособен. Для решения этой проблемы существует механизм высокой доступности YARN ResourceManager (high availability или HA), более подробно описанной в документации `Apache Hadoop <https://hadoop.apache.org/docs/r3.1.0/hadoop-yarn/hadoop-yarn-site/ResourceManagerHA.html>`_. Этот механизм предполагает больше одного хоста с YARN ResourceManager, требует сервиса ZooKeeper, но устойчив к недоступности компонента YARN ResourceManager на хостах кластера. До тех пор, пока хотя бы один хост с YARN ResourceManager будет доступен -- весь сервис YARN останется работоспособным.

После активации НА компонент YARN ResourceManager становится масштабируемым, что означает возможность добавить или удалить данный компонент с хостов кластера.

Для активации HA, добавления или удаления YARN ResourceManager с хостов необходимо воспользоваться соответствующими кнопками выпадающего меню, доступного по нажатию на иконку в поле *"Actions"* сервиса YARN:

.. figure:: /images/administration/yarn/buttons.png
   :align: center

   Выпадающее меню *"Actions"* сервиса YARN

.. important:: Описанные ниже операции не удаляют/добавляют хост из кластера -- они лишь управляют компонентом YARN ResourceManager на хостах. Удаление хоста из кластера возможно в разделе *"Hosts"* кластера в случаях, когда к хосту не привязан ни один компонент. Добавление хоста производится согласно :ref:`инструкции <add_hosts>`.

Активация HA YARN ResourceManager
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. important:: Операция активации высокой доступности (HA) необратима. Для функционирования сервиса YARN после активации HA потребуется доступный сервис ZooKeeper и 2 хоста с YARN ResourceManager.

Перед непосредственной активацией HA необходимо убедиться в удовлетворении двух условий:

1. сервис ZooKeeper :ref:`установлен <install_services>`;

2. в кластер ADH :ref:`добавлено <add_hosts>` больше одного хоста.

Для активации высокой доступности (HA) YARN ResourceManager необходимо:

1. нажать кнопку *"Enable ResourceManagers HA"*, что приведёт к появлению окна, аналогичному разделу *"Hosts - Components"* кластера, описанному в разделе :ref:`install_components`;

2. любым из двух способов назначить добавляемому компоненту хост (компонент YARN ResourceManager будет выделен белым как возможный к расширению):

   - выбрать компонент в колонке "Components" и назначить для него хост в колонке "Hosts";
   - выбрать хост в колонке "Hosts" и определить для него компонент в колонке "Components".

3. нажать кнопку *"Run"* в нижней части окна.

Добавление YARN ResourceManager
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Для добавления одной или нескольких дополнительных YARN ResourceManager на хосты кластера необходимо:

1. нажать кнопку *"Add ResourceManagers"*, что приведёт к появлению окна, аналогичному разделу *"Hosts - Components"* кластера, описанному в разделе :ref:`install_components`;

2. любым из двух способов назначить добавляемому компоненту хост (компонент YARN ResourceManager будет выделен белым как возможный к расширению):

   - выбрать компонент в колонке "Components" и назначить для него хост в колонке "Hosts";
   - выбрать хост в колонке "Hosts" и определить для него компонент в колонке "Components".

3. нажать кнопку *"Run"* в нижней части окна.

Удаление YARN ResourceManager
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. important:: Для функционирования сервиса YARN после активации HA требуется как минимум 2 хоста с YARN ResourceManager.

Для удаления одной или нескольких YARN ResourceManager с хостов кластера необходимо:

1. нажать кнопку *"Remove ResourceManagers"*, что приведёт к появлению окна, аналогичному разделу *"Hosts - Components"* кластера, описанному в разделе :ref:`install_components`;

2. любым из двух способов удалить привязку компонента к хосту (компонент YARN ResourceManager будет выделен белым как возможный к удалению с хостов):

   - выбрать компонент в колонке "Components" и убрать выделение с хостов в колонке "Hosts", рамки которых выделены зелёным;
   - выбрать хост в колонке "Hosts" и убрать выделение с компонента YARN ResourceManager в колонке "Components" если рамка компонета YARN ResourceManager выделяется зелёным.

3. нажать кнопку *"Run"* в нижней части окна.
