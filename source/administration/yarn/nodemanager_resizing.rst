Добавление/удаление и декомиссия YARN NodeManager
==================================================

Для добавления или удаления *YARN NodeManager* с хостов или привидения *YARN NodeManager* в состояние декомисии на хосте необходимо воспользоваться соответствующими кнопками выпадающего меню, доступного по нажатию на иконку в поле *"Actions"* сервиса *YARN* (:numref:`Рис.%s.<buttons>`).

.. _buttons:

.. figure:: ../../imgs/administration/yarn/buttons.png
   :align: center

   Выпадающее меню "Actions" сервиса YARN

Эти кнопки являются простым интерфейсом для управления состояниями *NodeManager*, более подробно описанным в документации `Apache Hadoop <https://hadoop.apache.org/docs/r3.1.0/hadoop-yarn/hadoop-yarn-site/GracefulDecommission.html>`_.

.. important:: Описанные далее операции не удаляют/добавляют хост из кластера -- они лишь управляют компонентом YARN NodeManager на хостах

Удаление хоста из кластера возможно в разделе *"Hosts"* кластера в случаях, когда к хосту не привязан ни один компонент. 

Добавление хоста осуществляется согласно :ref:`инструкции <add_hosts>`.

Добавление YARN NodeManager
------------------------------

Для добавления одной или нескольких дополнительных *YARN NodeManager* на хосты кластера необходимо:

1. Нажать кнопку *"Add NodeManagers"*, что приводит к появлению окна, аналогичному разделу *"Hosts - Components"* кластера, описанному в :ref:`install_components`.

2. Любым из двух способов назначить добавляемому компоненту хост (компонент *YARN NodeManager* выделяется белым как возможный к расширению):

   - Выбрать компонент в колонке "Components" и назначить для него хост в колонке "Hosts";
   - Выбрать хост в колонке "Hosts" и определить для него компонент в колонке "Components".

3. Нажать кнопку *"Run"* в нижней части окна.

Декомиссия YARN NodeManager
------------------------------

В случае необходимости вывести хост из работы или удалить из кластера его сначала необходимо декомиссовать.

Существует два типа декомиссии:

- Нормальный -- в этом режиме нода *YARN NodeManager* прекращает работу безусловно, не ожидая завершения работающих на ноде контейнеров;
- Изящный (graceful) -- в этом режиме планировщик *YARN* не будет назначать новые контейнеры декомиссованной ноде *YARN NodeManager*, а работающие контейнеры продолжат работу до истечения назначенного таймаута.

Для декомиссии одной или нескольких *YARN NodeManager* необходимо выполнить действия:

1. Нажать кнопку *"Decommiss NodeManagers"*, что приводит к появлению окна *"Action parameters"* (:numref:`Рис.%s.<decommission>`).

.. _decommission:

.. figure:: ../../imgs/administration/yarn/decommission.png
   :align: center
   
   "Action parameters"

2. Для добавления хоста в список декомиссованных необходимо нажать "+" и ввести fqdn хоста и таймаут в секундах. Через "+" можно добавить несколько хостов.

3. Нажать кнопку *"Run"* в нижней части окна.

Рекомиссия YARN NodeManager
------------------------------

Для рекомиссии (выведения хоста из состояния декомиссии) одной или нескольких *YARN NodeManager* необходимо:

1. Нажать кнопку *"Recommiss NodeManagers"*, что приводит к появлению всплывающего окна, аналогичному окну декомиссии (:numref:`Рис.%s.<decommission>`).

2. Для добавления хоста в список рекомиссованных необходимо нажать "+" и ввести fqdn хоста. Через "+" можно добавить несколько хостов.

3. Нажать кнопку *"Run"* в нижней части окна.

Удаление YARN NodeManager
---------------------------

Для удаления одной или нескольких *YARN NodeManager* с хостов кластера необходимо:

1. Нажать кнопку *"Remove NodeManagers"*, что приводит к появлению окна, аналогичному разделу *"Hosts - Components"* кластера, описанному в :ref:`install_components`.

2. Любым из двух способов удалить привязку компонента к хосту (компонент *YARN NodeManager* выделяется белым как возможный к удалению с хостов):

   - Выбрать компонент в колонке "Components" и убрать выделение с хостов в колонке "Hosts", рамки которых выделены зеленым;
   - Выбрать хост в колонке "Hosts" и убрать выделение с компонента *YARN NodeManager* в колонке "Components", если рамка компонента *YARN NodeManager* выделяется зеленым.

3. Нажать кнопку *"Run"* в нижней части окна.
