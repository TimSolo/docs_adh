Развертывание топологий кластера вручную
===========================================

После обновления свойств кластера повторное развертывание кластеров вручную не требуется. Шлюз отслеживает файлы дескрипторов топологии в каталоге *$gateway/conf/topologies* и автоматически перераспределяет кластер при изменении или добавлении дескриптора (соответствующее развертывание находится в *$gateway/data/deployments*).

Однако необходимо повторно развернуть кластеры после изменения любого из следующих свойств или параметров шлюза:

+ Настройка времени на хосте шлюза;
+ Внедрение или обновление Kerberos;
+ Внедрение или обновление SSL-сертификатов;
+ Изменение алиаса кластера.


Одновременное перераспределение всех кластеров
-----------------------------------------------

При внесении изменений на уровне шлюза (например, при реализации протокола Kerberos или SSL) или при изменении системного времени необходимо повторно развернуть все топологии кластера:

1. Для проверки временной метки на развернутых кластерах необходимо ввести: *cd $gatewaydir data/deployments*. Система при этом отображает информацию на подобии следующей:

  ::
  
   Directory of C:/hdp/knox-0.4.0.2.1.1.0-1557/data/deployments
   
   04/17/2014 05:30 PM <DIR> .
   04/17/2014 05:30 PM <DIR> ..
   04/17/2014 05:30 PM <DIR> cluster.war.145514f4dc8
   04/17/2014 05:30 PM <DIR> myCluster.war.145514f4dc8
   04/11/2014 08:35 AM <DIR> sandbox.war.145514f4dc8
    0 File(s) 0 bytes
    5 Dir(s) 9,730,977,792 bytes free

2. Для повторного развертывания всех кластеров необходимо ввести команду:

  :command:`/bin/knoxcli.cmd redeploy`

3. Для проверки вновь созданных кластеров использовать команду: *cd $gatewaydir data/deployments*. Система при этом отображает информацию на подобии следующей:

  ::

   Directory of C:/hdp/knox-0.4.0.2.1.1.0-1557/data/deployments
   
   04/17/2014 05:34 PM <DIR> .
   04/17/2014 05:34 PM <DIR> ..
   04/17/2014 05:30 PM <DIR> cluster.war.145514f4dc8
   04/17/2014 05:34 PM <DIR> cluster.war.1457241b5dc
   04/17/2014 05:30 PM <DIR> myCluster.war.145514f4dc8
   04/17/2014 05:34 PM <DIR> myCluster.war.1457241b5dc
   04/11/2014 08:35 AM <DIR> sandbox.war.145514f4dc8
   04/17/2014 05:34 PM <DIR> sandbox.war.1457241b5dc
    0 File(s) 0 bytes
    8 Dir(s) 9,730,850,816 bytes free

Для каждого кластера создается новый файл с текущей временной меткой.


Повторное развертывание определенного кластера
------------------------------------------------

При внесении изменений, влияющих на один кластер, таких как изменение алиаса или восстановление из более раннего файла дескриптора топологии кластера, перераспределяется только данный кластер. Для этого необходимо выполнить следующие действия:

1. Для проверки временной метки в WAR-файлах топологии развернутого кластера, необходимо ввести: *cd $gatewaydir data/deployments*. Система при этом отображает информацию на подобии следующей:

  ::
   
   Directory of C:/hdp/knox-0.4.0.2.1.1.0-1557/data/deployments
   
   04/17/2014 05:30 PM <DIR> .
   04/17/2014 05:30 PM <DIR> ..
   04/17/2014 05:30 PM <DIR> cluster.war.145514f4dc8
   04/17/2014 05:30 PM <DIR> myCluster.war.145514f4dc8
   04/11/2014 08:35 AM <DIR> sandbox.war.145514f4dc8
    0 File(s) 0 bytes
    5 Dir(s) 9,730,977,792 bytes free

2. Для повторного развертывания определенного кластера необходимо ввести команду:

  :command:`cd $gateway bin/knoxcli.cmd redeploy --cluster $cluster_name`

Где *$cluster_name* -- имя дескриптора топологии кластера (без расширения *.xml*). Например, *myCluster*.

3. Для проверки факта развертывания кластера использовать команду: *cd $gatewaydir data/deployments*. Система при этом отображает информацию на подобии следующей:

  ::

   Directory of C:/hdp/knox-0.4.0.2.1.1.0-1557/data/deployments
   
   04/17/2014 05:30 PM <DIR> .
   04/17/2014 05:30 PM <DIR> ..
   04/17/2014 05:30 PM <DIR> cluster.war.145514f4dc8
   04/17/2014 05:30 PM <DIR> myCluster.war.145514f4dc8
   04/17/2014 05:34 PM <DIR> myCluster.war.1457241b5dc
   04/11/2014 08:35 AM <DIR> sandbox.war.145514f4dc8
    0 File(s) 0 bytes
    5 Dir(s) 9,730,977,792 bytes free

Должно прослеживаться, что war-файлы кластера не изменились, за исключением обновленного файла для *myCluster* (имеет текущую временную метку).



