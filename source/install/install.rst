Установка ADH в ADCM
====================

Выгрузка бандла ADH в ADCM
^^^^^^^^^^^^^^^^^^^^^^^^^^

Выгрузка бандла ADH необходима для создания в ADCM прототипа кластера, из которого в дальнейшем возможно создание его экземпляров. 

Для выгрузки бандла следует выполнить действия аналогичные :doc:`выгрузке бандла хост провайдера <adcm_upload>`.

Создание экземпляра кластера
^^^^^^^^^^^^^^^^^^^^^^^^^^^^

При создании кластера в веб-интерфейсе ADCM генерируется новый экземпляр кластера ADH, что означает только добавление данных о нем в базу данных ADCM -- на этом этапе не производится установка ADH на хосты.

1. Открыть в ADCM вкладку "CLUSTERS":

.. figure:: images/cluster_mon.png
   :align: center

   Вкладка "CLUSTERS"

2. Нажать "Add cluster" и в открывшейся форме создать экземпляр кластера из прототипа ADH:

.. figure:: images/add_cluster.png
   :align: center

   Создание экземпляра кластера

3. В результате выполненных действий факт создания экземпляра кластера отображается в базе данных ADCM на вкладке "CLUSTERS":

.. figure:: images/clusters_list.png
   :align: center

   Результат успешного создания экземпляра кластера

Добавление сервисов кластера
^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. important:: На текущий момент невозможно удалить из кластера уже добавленный сервис

Возможность добавления нового сервиса в уже работающий кластер присутствует и не отличается от установки сервиса с нуля.

Для добавления сервисов в кластер ADH необходимо:

1. В меню кластера ADH открыть вкладку "Services":

2. Нажать "Add service" и в открывшейся форме выбрать необходимые сервисы:

.. figure:: images/add_services.png
   :align: center

   Выбор сервисов

Конфигурирование сервиса
^^^^^^^^^^^^^^^^^^^^^^^^

Для перехода к настройкам сервиса кластера необходимо нажать кнопку с пиктограммой шестеренки в соответствующей строке вкладки пункта меню "Services".

Добавление хостов
^^^^^^^^^^^^^^^^^

Для добавления хостов в кластер ADH необходимо:

1. В меню кластера ADH открыть вкладку "Hosts":

.. figure:: images/hosts_list.png
   :align: center

   Вкладка "Hosts" кластера ADH

2. Нажать "Add hosts" и в открывшейся форме выбрать необходимые хосты:

.. figure:: images/add_hosts.png
   :align: center

   Выбор хостов

3. В результате выполненных действий факт добавления хостов отображается в кластере ADH в списке вкладки "Hosts":

.. figure:: images/hosts_list2.png
   :align: center

   Результат успешного добавления хостов

Размещение компонентов сервисов на хостах
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Изначально ни на одном из хостов нет компонентов -- распределение компонентов происходит вручную.

Для размещения компонентов необходимо перейти на вкладку *"Hosts - Components"*:

.. figure:: images/components.png
   :align: center

   Размещение компонентов сервисов на хостах
   
И распределить компоненты одним из двух способов:

1. выбрать компонент в колонке "Components" и определить для него хост в колонке "Hosts";
2. выбрать хост в колонке "Hosts" и определить для него компонент в колонке "Components".

.. important:: в сервисе могут быть обязательные и необязательные компоненты. Если компонент обязательный, то в его количественном счётчике справа от названия присутствует символ '/'.

Конфигурирование кластера
^^^^^^^^^^^^^^^^^^^^^^^^^

Для перехода к настройкам экземпляра кластера ADH необходимо нажать кнопку с пиктограммой шестеренки в соответствующей строке вкладки "CLUSTERS" и перейти в раздел меню "Configuration". При этом открывается окно конфигурации выбранного экземпляра:

.. figure:: images/cluster_config.png
   :align: center

   Окно конфигурирования кластера

Установка сервисов кластера
^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. important:: порядок установки сервисов и зависимости между ними на данный момент не ограничивается со стороны ADCM.

Устанавливать сервисы необходимо в следюущем порядке:

1. Zookeeper

2. HDFS

3. YARN

4. MapReduce

5. HBase

6. Hive

7. Spark

8. Monitoring

Для установки добавленного сервиса необходимо в строке нужного сервиса в поле "Actions" нажать на пиктограмму и выбрать действие *install*.

По результатам инсталляции сервис изменяет состояние (столбец *"State"*) с *created* на *enabled*.

.. figure:: images/cluster_actions.png
   :align: center

   Состояние сервисов кластера

Сервис запускается автоматически.

Особенности установки сервисов
------------------------------

Hive
++++

Компонент Metastore сервиса Hive требует наличие БД MySQL/MariaDB и доступов к ней.

Сервис MySQL/MariaDB в дистрибутив ADH не входит, его необходимо устанавливать и настраивать другими средствами.

Указать сервису Hive адрес и учётные данные для подключения к БД возможно в `настройках сервиса <Конфигурирование сервиса_>`_.
